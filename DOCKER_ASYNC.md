# Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (Async –≤–µ—Ä—Å–∏—è)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é
docker compose down

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Å –Ω–æ–≤—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ (aiohttp –¥–ª—è async)
docker compose build --no-cache

# –ó–∞–ø—É—Å—Ç–∏—Ç—å async –≤–µ—Ä—Å–∏—é
docker compose up -d
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
```bash
# –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å "–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –≤ async —Ä–µ–∂–∏–º–µ polling..."
docker compose logs -f bot

# –ü—Ä–∏–º–µ—Ä –ª–æ–≥–æ–≤:
# –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –≤ async —Ä–µ–∂–∏–º–µ polling...
# MCP Manager initialized with 2 server configs
# Cache warmed up with 15 tools
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å healthcheck
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å async –±–æ—Ç–∞
docker compose ps

# bot –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "healthy"
# NAME                  STATUS
# telegram-bot-async    Up (healthy)
# minio                 Up (healthy)
```

## üìù –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### requirements.txt
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `aiohttp>=3.9.0` (—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è AsyncTeleBot)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

### Dockerfile
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω healthcheck –¥–ª—è async bot
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ–± async –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ
- ‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤–∫–ª—é—á–µ–Ω—ã

### docker-compose.yml
- ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ `telegram-bot-async`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω healthcheck
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `PYTHONUNBUFFERED=1` –¥–ª—è async –ª–æ–≥–æ–≤
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω—ã resource limits (async –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤)
  - CPU: 2.0 cores (–±—ã–ª–æ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)
  - Memory: 1GB (–±—ã–ª–æ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `minio-setup` completion

## üîß Resource Limits

### Bot (async –≤–µ—Ä—Å–∏—è)
```yaml
limits:
  cpus: '2.0'      # –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–æ 2 —è–¥–µ—Ä
  memory: 1G       # –ú–∞–∫—Å–∏–º—É–º 1GB RAM
reservations:
  cpus: '0.5'      # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ 0.5 —è–¥—Ä–∞
  memory: 256M     # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ 256MB RAM
```

**–ü–æ—á–µ–º—É –±–æ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤?**
- Async bot –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–æ—Ç–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ë–æ–ª—å—à–µ concurrent –∑–∞–ø—Ä–æ—Å–æ–≤ = –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏ –¥–ª—è event loop
- 2 CPU cores –ø–æ–∑–≤–æ–ª—è—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏

### MinIO
```yaml
limits:
  cpus: '1.0'      # –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è S3 –æ–ø–µ—Ä–∞—Ü–∏–π
  memory: 512M     # –û–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ async –≤–µ—Ä—Å–∏–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å concurrent –æ–±—Ä–∞–±–æ—Ç–∫—É
```bash
# –û—Ç–∫—Ä—ã—Ç—å –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker compose logs -f bot

# –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —Å 2-3 –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
# –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É:
# API request started: chat_id=123
# API request started: chat_id=456  ‚Üê —Å—Ä–∞–∑—É!
# API response received: chat_id=123, duration=27s
# API response received: chat_id=456, duration=26s
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å asyncio event loop
```bash
# –ó–∞–π—Ç–∏ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker exec -it telegram-bot-async sh

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ asyncio —Ä–∞–±–æ—Ç–∞–µ—Ç
python -c "import asyncio; print('AsyncIO OK')"

# –í—ã—Ö–æ–¥
exit
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats telegram-bot-async

# –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
# CPU % - –æ–±—ã—á–Ω–æ < 50% (–ø–∏–∫–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ)
# MEM USAGE - 200-400MB –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏
```

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "aiohttp not found"
```bash
# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ —Å --no-cache
docker compose build --no-cache bot
docker compose up -d
```

### –ü—Ä–æ–±–ª–µ–º–∞: Healthcheck failed
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker compose logs bot

# –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ asyncio, –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
docker compose down
docker compose build --no-cache
docker compose up -d
```

### –ü—Ä–æ–±–ª–µ–º–∞: –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
```bash
# –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è async –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏ –±–æ–ª—å—à–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
# –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 1GB, —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç –≤ docker-compose.yml:
# memory: 2G
```

### –ü—Ä–æ–±–ª–µ–º–∞: Bot container –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
docker compose logs bot | tail -100

# –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
# 1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (.env —Ñ–∞–π–ª)
# 2. MCP –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (mcp.json)
# 3. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤
```

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å sync –≤–µ—Ä—Å–∏–µ–π

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Sync (—Å—Ç–∞—Ä–∞—è) | Async (–Ω–æ–≤–∞—è) |
|----------|---------------|---------------|
| Concurrent users | 1 (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏) | ‚àû (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ) |
| CPU usage | ~30% (1 core) | ~50% (2 cores) |
| Memory | ~150MB | ~250MB |
| Response time | –ë–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π |
| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä | `telegram-bot` | `telegram-bot-async` |
| Healthcheck | –ù–µ—Ç | –î–∞ ‚úÖ |

## üîÑ –û—Ç–∫–∞—Ç –Ω–∞ sync –≤–µ—Ä—Å–∏—é

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å async –≤–µ—Ä—Å–∏—é
docker compose down

# –û—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git checkout HEAD~1 requirements.txt
git checkout HEAD~1 Dockerfile
git checkout HEAD~1 docker-compose.yml

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
docker compose build --no-cache
docker compose up -d
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose ps

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –±–æ—Ç–∞
docker compose restart bot

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
docker stats

# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∏ –Ω–∞—á–∞—Ç—å —Å –Ω—É–ª—è
docker compose down -v
docker compose build --no-cache
docker compose up -d
```

---

**–í–µ—Ä—Å–∏—è:** 2.0 (AsyncTeleBot)
**–î–∞—Ç–∞:** 2026-02-08
